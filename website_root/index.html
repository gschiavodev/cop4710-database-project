<?php
    
    session_start();

    // Check if the logout link was clicked
    if (isset($_GET['logout'])) 
    {

        // End the session
        session_destroy();

        // Redirect to the login page
        header('Location: index.html');
        exit();

    }

    // Check if user is logged in
    if (isset($_SESSION['username'])) 
    {

        // Database connection information
        $servername = "mysql";
        $username = "webserver";
        $password = "X7g9#4vZ1$2cQ5";
        $database = "college_events";

        // Create connection
        $conn = mysqli_connect($servername, $username, $password, $database);

        // Check connection
        if (!$conn) 
            die("Connection failed: " . mysqli_connect_error());

        // The form was submitted, let's try to log the user in
        // Assuming $conn is your MySQLi connection
        $username = $_POST['username'];
        $password = $_POST['password'];

        // Prepare a SELECT statement to get the user with the provided username
        $statement = $conn->prepare("SELECT * FROM super_admin WHERE id = ? UNION SELECT * FROM admin WHERE id = ?");
        $statement->bind_param("ii", $_SESSION['user_id'], $_SESSION['user_id']);
        $statement->execute();

        // Get the result of the SELECT query
        $result = $statement->get_result();

        // Check if the user exists
        $_SESSION['is_admin'] = $result->num_rows != 0 ? true : false;

    }

?>

<!DOCTYPE html>

<html lang="en">

    <head>
        <title>College Event Website</title>
        <link rel="stylesheet" type="text/css" href="css/common_styles.css">
    </head>

    <body>
        
        <header>
            <nav>
                <ul>

                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html">Events</a></li>
                    <li><a href="index.html">RSOs</a></li>

                </ul>
                <ul>

                    <?php if (isset($_SESSION['username'])) :?>

                        <?php if ($_SESSION['is_admin']) :?>

                            <!-- This content will only be shown if the user is an admin -->
                            <li><a href="admin.html">Admin</a></li>
                            
                        <?php endif; ?>

                        <!-- This content will only be shown if the user is logged in -->
                        <li><a href="index.html?logout=true">Logout</a></li>

                    <?php else: ?>

                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>

                    <?php endif; ?>

                </ul>
            </nav>
        </header>

        <main>

            <div class="row">

                <section>
                    <h1>College Event Website</h1>
                    <p>Welcome to the College Event Website! This platform is designed to help students keep track of events happening around campus. Whether you're looking for social events, fundraising activities, or tech talks, you'll find all the information you need right here. Register to start exploring events, join RSOs, and more!</p>
                </section>
                
            </div>

            <div class="row">

                <section>
                    <h2>Section 1</h2>
                    <p>Section 1 content goes here.</p>
                </section>

                <section>
                    <h2>Section 2</h2>
                    <p>Section 2 content goes here.</p>
                </section>

            </div>

        </main>

        <footer>
            <p>&copy; Gabriel Schiavo</p>
        </footer>
        
    </body>
</html>